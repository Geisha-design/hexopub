---
layout: port
title: 内网穿透
date: 2022-04-07 16:06:21
tags: 计算机技术
---

1、在互联网主干道上，大家都是用的公网IP来标识自己。知道这个IP，就可以直接定位连接。

2、IP有两种，IPV4、IPV6；只有IPV4会有内网穿透的情况

3、鉴于IPV4的数量，不可能让所有设备都在主干道上标识自己的且是不重复的唯一IP

4、所以就想了个办法，把一个区域内的所有设备连在一起并统一和主干道上其他区域设备联系，对外只共用一个公网IP来标识自己，对内则分配一些够用的私有地址。简称NAT

5、设备与设备之间的连接除了物理存在的端口外，还有软件层面的端口，要产生连接必须要有个端口给你把数据传进去。<!--more-->

6、所以NAT就干了这么一件事：私有IP+端口《--》公网IP+端口  从而实现某台内网机器的上网

7、而当自己所能操作的范围内没有公网ip，就不能实现自己想要的内网穿透。但实际上只要你能上网，对外而言你就一定有一个公网ip，只是你操作不到！比如小区局域网、城域局域网

8、而内网穿透，本质就是对公网IP或者端口做文章，从而实现自定义访问。

9、比如使用其他的公网IP：

​        a：需要一台自己拥有的能够操作的、具有公网IP的机子A（物理机、[虚拟机](https://www.zhihu.com/search?q=虚拟机&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"answer"%2C"sourceId"%3A1500976034})都可以）

​        b：需要进行端口映射/转发，让本地局域网的机子和机子A建立联系，从而实现内网穿透

​        c：nat123、花生壳、frp、只要是类似的，都是这种模式：使用其他能操作的公网ip进行转发

​        d：这种模式的好处在于访问端可以直接用域名或地址访问而不需要安装其他任何辅助[客户端](https://www.zhihu.com/search?q=客户端&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"answer"%2C"sourceId"%3A1500976034})

​        f：缺点是机子A可能需要另外购买，还要付对应的宽带费用。像花生壳它自己的服务器就是机子A，给你提供这样的服务，便宜的带宽也小、速度也慢，顺带给你一个域名解析。

10、知道端口后直接连：

​       a：一般情况下，NAT转换出去的端口是随机的，但你要知道，我们手机或电脑上玩的各种软件是可以和他们自己的服务器进行双向通信的。

​       b：原因就是，在他们通信的时候，相互获取了对方的公网IP+端口（有些app是固定的域名）

​       c：而不管是p2p连接，还是VPN，只要是类似的，就是这种模式

​       d：它必须在两端都安装使用辅助的客户端才行（可以理解为获取对方地址相互连接，甚至还可以加密提高安全性）

​       f：这种模式的难点在于建立起初始连接，有很多种方式，简称打洞、穿越。

​       g：缺点就是才说的：两端必须都需要安装使用辅助客户端来实现。

11、ipv6就不存在内网穿透的问题，因为终端设备获取的几乎都是可以直接访问的IPV6地址，所以，我自家服务器使用的IPV4转发穿透+IPV6；IPV6无法访问的时候（访问设备也要支持IPV6）就用IPV4访问。

12、对于有自己能操作的公网IPV4地址，那么，最简单的，对应路由器里面登录花生壳账号，实现域名解析，然后在端口映射内网主机即可。